# M1：不適切なプラットフォームの利用

<table>
 <tr>
  <th>脅威エージェント</th>
  <th>攻撃経路</th>
  <th colspan="2">セキュリティ上の弱点</th>
  <th>技術的な影響</th>
  <th>ビジネスへの影響</th>
 </tr>
 <tr>
  <td>アプリケーション依存 </td>
  <td>攻撃難易度：容易</td>
  <td>普及度：中</td>
  <td>検出難易度：普通</td>
  <td>深刻な影響</td>
  <td>アプリケーション / ビジネス依存</td>
 </tr>
 <tr>
  <td>本カテゴリは、プラットフォーム機能の誤用や、プラットフォームセキュリティコントロールの不使用が対象です。Androidインテント、プラットフォームのアクセス許可、TouchIDの誤用、キーチェーン、モバイルOSの一部である他のセキュリティコントロールが含まれます。</td>
  <td>攻撃経路は、これまでのOWASP Top Tenの攻撃経路と同じです。公開しているあらゆるAPIコールが攻撃経路となります。</td>
  <td colspan="2">本脆弱性が攻撃されるには、組織はモバイルアプリで使用するWebサービスやAPIコールを公開しなければいけません。その公開されたサービスやAPIコールは、サーバ内でOWASP Top Tenの脆弱性を生み出す危険なコーディング技術で実装されており、攻撃者はモバイルのインターフェースから脆弱なエンドポイントに、悪意のある入力値もしくはイベントを想定外の順序で送信することができます。それゆえ、攻撃者はサーバ上に存在するOWASP Top Tenの脆弱性に気付くことができます。</td>
  <td>本脆弱性の技術的な影響は、攻撃者がモバイルデバイスを通して悪用する脆弱性(OWASP Top Tenで定義されている)の技術的な影響と一致します。<br>例えば、攻撃者はモバイルデバイスを通してクロスサイトスクリプティング(XSS)脆弱性を悪用するかもしれません。<br>これは中程度の技術的な影響であるOWASP Top Ten A3 - XSSカテゴリと一致します。 </td>
  <td>本脆弱性のビジネスへの影響は、攻撃者がモバイルデバイスを通して悪用する脆弱性(OWASP Top Tenで定義されている)のビジネスへの影響と一致します。<br>例えば、攻撃者はモバイルデバイスを通してクロスサイトスクリプティング(XSS)脆弱性を悪用するかもしれません。これはOWASP Top Ten A3 - XSSカテゴリのビジネスへの影響と一致します。</td>
 </tr>
</table>

## 脆弱性有無の確認
本カテゴリでのリスクの重要な特徴は、プラットフォーム(iOS、Android、Windows Phoneなど)はドキュメント化されていてよく理解がされている機能を提供していますが、アプリがその機能を利用しない、もしくは間違って利用してしまうことです。本カテゴリは、この設計と実装は厳密にはアプリケーション開発者の問題ではないため、他のMobile Top Tenのカテゴリとは異なります。
モバイルアプリでこのリスクが発生する原因は、以下のようなものが挙げられます。

1. 公開されているガイドラインへの違反
 全てのプラットフォームには、セキュリティのための開発ガイドラインが存在します(Android、iOS、Windows Phoneを参照)。プラットフォームの開発会社によって推奨されているベストプラクティスにアプリが違反している場合は、本リスクにさらされている可能性があります。例えば、iOSキーチェーンの使用方法やAndroidでエクスポートされたサービスを安全に利用する方法に関するガイドラインがありますが、これらのガイドラインに従わないアプリには本リスクが存在します。

2. 規約やコモンプラクティスへの違反
 プラットフォームの開発会社のガイダンスには、全てのベストプラクティスが体系化されているわけではありません。モバイルアプリで一般的とされる事実上のベストプラクティスが存在する場合もあります。

3. 故意でない誤用
 正しいことをしようしているアプリにおいて、実際には実装で間違ったことをしている場合があります。APIコールで間違ったフラグを設定してしまうといったような単純なバグや、保護機能の動作に関しての誤解が原因といったことがあります。

プラットフォームのアクセス許可モデルにおける失敗は、本カテゴリに該当します。たとえば、アプリが多くのアクセス許可を要求しすぎたり、間違ったアクセス許可を要求する場合は、本カテゴリに分類されます。

## 防止方法
モバイルアプリのサーバサイドにおいて、安全なコーディングと設定のプラクティスが実施されるべきです。詳細な脆弱性情報に関しては、「OWASP Web Top Ten」または「Cloud Top 10」のプロジェクトを参照してください。

## 攻撃シナリオの例
数百、数千のAPIを有するプラットフォームがいくつか存在するため、本セクションの例は、何が可能なのかについて表面的に論じているにすぎません。

### キーチェーンではなくアプリのローカルストレージを利用することについて
iOSキーチェーンは、アプリとシステムデータ両方にとって安全なデータ保存機能です。iOSでは、どんなに小さなデータ(セッションキー、パスワード、デバイス登録データなど)であってもセキュリティ上重要性があるのなら、アプリはこの機能を利用して保存するべきです。よくある間違いは、アプリのローカルストレージにそのようなアイテムを保存することです。アプリのローカルストレージに保存されたデータは、暗号化されていないiTunesバックアップ(例えば、ユーザのコンピュータ上)からアクセス可能です。アプリによっては、そのような露出は不適切です。
以下にM1を満たすために軽減すべきリスクと脆弱性が多く存在することが見ることができます。

<table>
  <tr><th>Cloud Top 10 Risks</th></tr>
  <tr><th>R1 - アカウンタビリティとデータリスク</th></tr>
  <tr><th>R2 - ユーザIDフェデレーション</th></tr>
  <tr><th>R3 - 法規制の順守</th></tr>
  <tr><th>R4 - ビジネスの継続性と弾力性</th></tr>
  <tr><th>R5 - ユーザプライバシーとデータの二次利用</th></tr>
  <tr><th>R6 - サービスとデータの統合</th></tr>
  <tr><th>R7 - マルチテナンシーと物理セキュリティ</th></tr>
  <tr><th>R8 - インシデンス分析とフォレンジック</th></tr>
  <tr><th>R9 - インフラセキュリティ</th></tr>
  <tr><th>R10 - 本番でない環境の露出</th></tr>
</table>

<table>
  <tr><th>OWASP Top 10 - 2013</th></tr>
  <tr><th>A1 - インジェクション</th></tr>
  <tr><th>A2 - 認証とセッション管理の不備</th></tr>
  <tr><th>A3 - クロスサイトスクリプティング(XSS)</th></tr>
  <tr><th>A4 - 安全でないオブジェクト直接参照</th></tr>
  <tr><th>A5 - セキュリティ設定のミス</th></tr>
  <tr><th>A6 - 機密データの露出</th></tr>
  <tr><th>A7 - 機能レベルアクセス制御の欠落</th></tr>
  <tr><th>A8 - クロスサイトリクエストフォージェリ(CSRF)</th></tr>
  <tr><th>A9 - 既知の脆弱性を持つコンポーネントの使用</th></tr>
  <tr><th>A10 - 未検証のリダイレクトとフォワード</th></tr>
</table>

### 最悪の違反者
以下は、OWASPがモバイルアプリケーションで最もよく見かける脆弱性タイプのリストです。

### 不十分なWebサービスのハードニング
  ロジック欠陥<br>
    [ビジネスロジック欠陥のテスト](https://www.owasp.org/index.php/Testing_for_business_logic_(OWASP-BL-001))<br>
    [ビジネスロジックセキュリティチートシート](https://www.owasp.org/index.php/Business_Logic_Security_Cheat_Sheet)<br>

  脆弱な認証<br>
    [OWASP Top Ten 認証の不備のセクション](https://www.owasp.org/index.php/Top_10_2013-A2-Broken_Authentication_and_Session_Management)<br>
    [認証のチートシート](https://www.owasp.org/index.php/Authentication_Cheat_Sheet)<br>
    [認証の開発者ガイド](https://www.owasp.org/index.php/Guide_to_Authentication)<br>
    [認証のテスト](https://www.owasp.org/index.php/Testing_for_authentication)<br>

  脆弱なセッション管理またはセッション管理の欠如<br>
  セッションフィクセーション<br>
  GETメソッドを用いた機密データの送信<br>

### 安全でないWebサーバの設定
  デフォルトのコンテンツ<br>
  管理者用インターフェース

### Webサービスとモバイル用のWebサイト両方に存在するインジェクション(SQL、XSS、コマンド)
### 認証の欠陥
### セッション管理の欠陥
### アクセスコントロールの脆弱性
### ローカルとリモートファイルインクルージョン

## 参考資料
### OWASP
 - [OWASP Top 10](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project)

### その他
 - [外部参照](http://cwe.mitre.org/)
