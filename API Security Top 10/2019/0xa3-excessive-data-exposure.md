API3:2019 Excessive Data Exposure (データの過剰な公開)
=================================

| 脅威エージェント/攻撃経路 | セキュリティ上の弱点 | 影響 |
| - | - | - |
| API 依存 : 攻撃難易度 **3** | 蔓延度 **2** : 検出難易度 **2** | 技術的影響 **2** : ビジネス依存 |
| 必要以上のデータ開示の利用は単純であり、通常、トラフィックを盗聴することでAPI レスポンスを解析し、ユーザに返すべきでない機密データ開示を探すことで実行される。 | API は、クライアントに依存してデータフィルタリングを実行する。API はデータソースとして使用されるため、開示されたデータの機密度合いについて考慮することなく、開発者は一般的な方法で実装しようとすることがある。通常、自動化されたツールはこの種の脆弱性を検知することができない。なぜならば、アプリケーションに対する深い理解なしに、API から返される正規のデータと返されるべきでない機密データを識別することが困難だからである。 | 必要以上のデータ開示は、一般的に機密データの暴露につながる。 |

## API が脆弱かどうかの確認

API は、設計によってクライアントに機密データを返す。このデータは通常、ユーザに提示される前にクライアント側でフィルタリングされる。攻撃者は容易にトラフィックを盗聴し、機密データを確認することができる。


## 攻撃シナリオ例

### シナリオ #1

モバイルチームは、コメントメタデータをレンダリングするために、アーティクルビューで `/api/articles/{articleId}/comments/{commentId}` エンドポイントを使用する。モバイルアプリケーショントラフィックを盗聴して、攻撃者はコメントの作成者に関連する他の機密データが返されることも調査する。エンドポイントの実装は、PII を含む `User` モデルで汎用の `toJSON()` メソッドを使用することで、オブジェクトをシリアライズする。

### シナリオ #2

IoT ベースの監視システムは、管理者が異なる権限を持ったユーザを生成することができる。管理者は、サイト上の特定の建物のみにアクセスする新たなセキュリティ保護のためのユーザアカウントを生成する。一度セキュリティ保護がモバイルアプリを使用すると、利用可能なカメラに関するデータを受け取って、ダッシュボードに表示するために、API 呼び出しが `/api/sites/111/cameras` にトリガされる。レスポンスには、カメラに関する詳細を含むリストが `{"id":"xxx","live_access_token":"xxxx-bbbbb","building_id":"yyy"}` の形式で含まれる。クライアント GUI はセキュリティ保護がアクセスする必要があるカメラだけを表示するが、実際の API のレスポンスには、サイトのカメラ全ての完全なリストが含まれている。

## 対策方法

* 機密データをフィルタリングするために、クライアント側を決して信頼しない。
* API からのレスポンスをレビューし、妥当なデータのみが含まれていることを確認する。
* バックエンドエンジニアは、新たな API エンドポイントを公開する前に、"データの消費者はだれなのか？" を常に自問するべきである。
* `to_json()` や `to_string()` などの汎用メソッドの使用を避ける。代わりに、本当に返したい特定のプロパティを入念に選定する。
* アプリケーションが保存・処理する機微情報や個人識別情報 (PII) を分類し、その様な情報を返す全ての API 呼び出しについて、これらのレスポンスがセキュリティ問題を引き起こすかどうかレビューする。
* セキュリティの追加層として、スキーマベースのレスポンス検証メカニズムを実装する。これらのメカニズムの一部として、エラーを含む全ての API メソッドによって返されたデータを定義して実行する。


## References

### External

* [CWE-213: Intentional Information Exposure][1]

[1]: https://cwe.mitre.org/data/definitions/213.html
